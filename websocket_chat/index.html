<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat App</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f5f5f7;
            display: flex;
            flex-direction: column;
            height: 100vh; /* Full height for fixed footer */
        }

        /* Header styles */
        .header {
            background-color: #007aff;
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 1.2rem;
        }

        /* Chat container styles */
        ul#messages {
            list-style-type: none;
            margin: 0;
            padding: 1rem; /* Add padding for better spacing */
            max-width: 800px;
            margin: 1rem auto;
            flex: 1; /* Allow messages to grow */
            overflow-y: auto; /* Enable scrolling */
            display: flex;
            flex-direction: column; /* Stack messages vertically */
        }

        #messages > li {
            padding: 0.5rem 1rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            display: inline-block;
            max-width: 70%;
            position: relative;
            word-wrap: break-word;
            font-size: 1rem;
            transition: background-color 0.2s; /* Smooth background change */
        }

        /* Sent message (align right) */
        #messages > li.sent {
            background-color: #007aff;
            color: white;
            margin-left: auto;
            text-align: right;
            border-bottom-right-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Add shadow for depth */
        }

        /* Received message (align left) */
        #messages > li.received {
            background-color: #e5e5ea;
            color: black;
            margin-right: auto;
            text-align: left;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Add shadow for depth */
        }

        /* Timestamp styling */
        .timestamp {
            font-size: 0.75rem;
            color: #888;
            position: absolute;
            bottom: -1.5rem;
            white-space: nowrap;
        }

        /* Positioning timestamp based on message alignment */
        #messages > li.sent .timestamp {
            right: 0;
        }

        #messages > li.received .timestamp {
            left: 0;
        }

        /* Input form styling */
        #form {
            background: rgba(0, 0, 0, 0.15);
            padding: 0.25rem;
            display: flex;
            height: 3rem;
            box-sizing: border-box;
            backdrop-filter: blur(10px);
        }

        #input {
            border: none;
            padding: 0 1rem;
            flex-grow: 1;
            border-radius: 2rem;
            margin: 0.25rem;
            font-size: 1rem; /* Increase font size */
        }

        #input:focus {
            outline: none;
        }

        #form > button {
            background: #333;
            border: none;
            padding: 0 1rem;
            margin: 0.25rem;
            border-radius: 3px;
            outline: none;
            color: #fff;
        }

        /* Hide the default submit button */
        #form > input[type="submit"] {
            display: none;
        }
    </style>
</head>

<body>
    <div class="header">Chat with John Doe</div> <!-- Header for contact name -->
    <ul id="messages"></ul>
    <form name="publish" class="form-cont" id="form">
        <input type="text" name="message" id="input" autocomplete="off" placeholder="Type your message..." />
        <input type="submit" value="Send" />
    </form>
    <script>
        function getRandomInteger(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        let random = getRandomInteger(0, 1_000_000)

        localStorage.setItem("senderID", getRandomInteger(0, 1_000_000));
        let socket = new WebSocket("ws://localhost:8080");

        // send message from the form
        document.forms.publish.onsubmit = function () {
            let outgoingMessage = this.message.value.trim();

            let payload = {
                message: outgoingMessage,
                timestamp: new Date().toLocaleString(),
                senderId: random
            }

            console.log("Payload generated: ", payload);
            this.message.value = "";

            let serialized = JSON.stringify(payload);
            socket.send(serialized);

            return false;
        };

        // message received - show the message in div#messages
        socket.onmessage = function (event) {
            let message = event.data;
            let rcvMsg = JSON.parse(message);
            console.log(rcvMsg);

            let messageElem = document.createElement('li');
            let timestamp = document.createElement('span');

            messageElem.textContent = rcvMsg.message;
            timestamp.textContent = rcvMsg.timestamp;

            timestamp.classList.add('timestamp');
            if (rcvMsg.senderId === "server") {
                messageElem.classList.add("server-msg");
            } else {
                if (rcvMsg.senderId === random) {
                    messageElem.classList.add("sent");
                } else {
                    messageElem.classList.add("received");
                }
            }
            messageElem.appendChild(timestamp); // Add timestamp to message
            document.getElementById('messages').append(messageElem);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight; // Scroll to the bottom
        }
    </script>
</body>

</html>
